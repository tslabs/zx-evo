# Управление процессором

TS конфигурация позволяет изменять частоту работы процессора и управлять кэшированием запросов в RAM. Основным регистром управления является **SysConfig**. По сигналу RESET в него записывается значение $01 - кэширование отключено, частота работы процессора 7MHz.

##### Регистр SysConfig
	Биты 7  6  5  4  3   2    1    0
         -  -  -  -  - CACHE ZCLK[1:0]
	R/W                  W    W    W
	Init x  x  x  x  x   0    0    1

* Биты 7:3 - зарезервированы.
* Бит 2 - разрешение кэширования запросов в RAM,
* Биты 1:0 - управление частотой процессора,

### Изменение частоты работы процессора <a name="clock"></a>

Всего поддерживается 3 режима работы процессора: 3.5MHz, 7.0MHz, 14.0MHz. Два младших бита регистра **SysConfig** позволяют выбрать один из этих режимов согласно следующей таблице:

ZCLK[1:0]| MHz
---------|----
00       |3.5
01       |7.0
10       |14.0
11       |зарезервировано

### Кэширование запросов к RAM <a name="cache"></a>

В TS конфигурации можно включить кэширование всех запросов на чтение/запись между процессором и RAM. Запросы к ROM не кэшируются.

Отображаемая процессору память (64кб) условно делится на 4 окна по 16 килобайт и для каждого такого окна в регистре **CacheConfig** предусмотрен соответствующий бит, который включает или отключает кэшироване в этом окне.

##### Регистр CacheConfig
	Биты 7  6  5  4    3       2       1       0
         -  -  -  - EN_C000 EN_8000 EN_4000 EN_0000
	R/W                W       W       W       W
	Init x  x  x  x    0       0       0       0

* Биты 7:4 - зарезервированы.
* Бит 3 - разрешение кэширования окна RAM $C000-$FFFF,
* Бит 2 - разрешение кэширования окна RAM $8000-$BFFF,
* Бит 1 - разрешение кэширования окна RAM $4000-$7FFF,
* Бит 0 - разрешение кэширования окна RAM $0000-$3FFF,

При записи значения в бит *CACHE* регистра **SysConfig** это же значение копируется в биты 0-3 регистра **CacheConfig**. Это позволяет включать и отключать кэширование глобально для всех страниц RAM.

**Внимание!** Запросы от DMA к RAM не кэшируются. По этой причине после DMA транзакций, работающих с окнами RAM для которых включено кэширование, необходимо проводить инвалидацию кэша.

Инвалидация кэша представляет из себя цикл, в котором последовательно считываются любые 256 байт. Пример инвалидации кэша:

    LD HL,$FF00
	LD DE,$FF00
	LD BC,$0100
	LDIR
