# Контроллер прерываний

Для всех режимов прерываний (`IM 0`, `IM 1`, `IM 2`) TS конфигурация поддерживает несколько источников маскируемого прерывания INT:

* Кадровый (*FRAME*)
* Строчный (*LINE*)
* Окончание DMA транзакции (*DMA*) 

Источник *FRAME* срабатывает, когда значение счетчиков растра совпадает с регистрами **HSINT**, **VSINT**. Источник *LINE* срабатывает в каждой строке, когда горизонтальный счетчик растра равен 0. Источник *DMA* срабатывает после окончания DMA транзакции.

В случае прихода нескольких событий одновременно, сначала обрабатывается прерывание с меньшим приоритетом. При завершении ISR инструкциями `EI : RET` сразу произойдет обработка следующего по порядку прерывания, которое распознается в последнем машинном цикле инструкции `RET`.

В режиме `IM 2` каждый источник прерывания формирует сигнал INT и выставляет собственный адрес на шину данных.

Источник|Приоритет|Адрес
--------|---------|-----
FRAME   |    0    | $FF 
LINE    |    1    | $FD 
DMA     |    2    | $FB 

Регистр **INTMask** содержит биты индивидуального источника маскируемого прерывания: 0 - запрещен, 1 - разрешен. По RESET туда записывается значение $01 - разрешен *FRAME*, все остальные запрешены. Если из ISR с меньшим приоритетом записать 0 в соответствующий бит маски источника прерывания, ожидающего в данный момент обработки, то произойдет его сброс и прерывание обработано не будет. Запись 1 не влияет на состояние ожидающего прерывания.

##### Регистр INTMask

	Биты  7   6   5   4   3   2    1    0
          -   -   -   -   -  DMA LINE FRAME
	R/W                       W    W    W
	Init  x   x   x   x   x   0    0    1

* Биты 7:3 - зарезервированы,
* Бит 2 - разрешение источника *DMA*,
* Бит 1 - разрешение источника *LINE*,
* Бит 0 - разрешение источника *FRAME*,
