;Ilich Editor v0.3;(C) BUDDER/MGN 2017;-------------------------------------------------------------------------------HEADER  EQU #6000BINAR   EQU HEADER+512        ORG HEADERWLD     EQU #6006; Plugin System Call PointTMN     EQU #6009; TimerDFCOL   EQU %00010111; Default ColorLNZ     EQU 1; Y offset on ScreenPGZ     EQU 0; TXT Buffer Start PagePGM     EQU #3F; TXT Buffer End Page;-------------------------------------------------------------------------------;PLUGIN HEADER        DS 16; Reserved        DB "WildCommanderMDL"; Header        DB #08; v0.8 of Plugin System Needed        DB 0; Reserved        DB 2; Pages        DB 0; Page to #8000        DB 0,1+(ENDPL-PLUGIN)/512; Main Code (page and size).5      DB 0,0        DS 16        DS 32*3; File extensions        DB 0        DW #FFFE,#000F; Max File Size        DB "TXT Editor v0.3                 "; Plugin Name        DB #14,"Edit  ";-------------------------------------------------------------------------------        ORG #8000,BINARENTRYN  EQU #A100FLLOAD  EQU ENTRYN-1FLMAKE  EQU ENTRYN-5WHEAD   EQU ENTRYN+512;-------PLUGIN  LD (DAHL),HL,(DADE),DE        XOR A        LD (ESTA),A        LD (CHANGES),A        LD HL,BC        LD DE,ENTRYN        LD BC,256:LDIR        CALL LOAD        CALL GEDPL        LD IX,PLWND:CALL PRWOW        CALL NAMETOH        XOR A        LD (CRX),A        LD A,PGZ        LD (PGHLP+2),A        LD (LNHLP+2),A        LD (LHLCR+2),A        LD HL,0        LD (PGHLP),HL        LD (LNHLP),HL        LD (LHLCR),HL        CALL REFRESH        LD HL,#0100,A,#FE:CALL ISTRMAIN    EI:HALT        LD A,#FC:CALL ISTR,STUPD        LD A,#03:CALL ISTR        CALL CTRL:JR Z,NOAD        CALL HOME,NZ,GOSTART:JR NZ,MAIN        CALL END,NZ,GOEND:JR NZ,MAIN        LD A,1:CALL KBSCN        CP "s":CALL Z,QSAVE        CP "f":CALL Z,SEARCH        CP "g":CALL Z,SEARCHNEXT        JR MAINNOAD    CALL HOME,NZ,SSQ        CALL END,NZ,SSE        CALL ENKE,NZ,GO0D        CALL BSPC,NZ,BSPACE        CALL DEL,NZ,DELETE;-------        XOR A:CALL KBSCN,NZ,SMBADD        CALL LFFF,NZ,GOLF        CALL RGGG,NZ,GORG        CALL UPPP,NZ,GOUP        CALL DWWW,NZ,GODW        CALL PGUP,NZ,GOPU        CALL PGDN,NZ,GOPD        CALL F1,NZ,F1MENU        CALL ESC:JP Z,MAIN;-------EXIT    CALL SAVECH:JP C,MAIN        CALL RRESB        LD A,(ESTA)        RET;---------------------------------------;Move Page to File StartGOSTART      CALL CRM13UGGSTART      CALL CR13U:JP C,GGSTART             LD A,PGZ,(PGHLP+2),A             LD HL,0,(PGHLP),HL:CALL REFRESH             LD A,1:OR A:RET;-------;Move Page to File EndGOEND        CALL CRM13DGGEND        CALL CR13D:JP C,GGEND             LD HL,LHLCR,DE,PGHLP,BC,3:LDIR             LD A,(IX+5):SUB LNZ+1+1             LD B,AGEND         PUSH BC:CALL PGMUZ             POP BC:JR NC,Gend             DJNZ GENDGend         CALL FILE_END_FND             LD A,1:OR A:RET;-------;Move Page UpGOPU         CALL CRM13U             LD A,(IX+5):SUB LNZ+1             LD B,APGU_CUR_MOVE PUSH BC:CALL CRM13U,PGMUZ             POP BC:JR NC,FILE_UP_FND             DJNZ PGU_CUR_MOVE             CALL INCCURFILE_UP_FND  LD A,(CRX):CALL CRMFWD             JP REFRESH;-------;Move Page DownGOPD         LD A,(IX+5):SUB LNZ+1             LD B,APGD_CUR_MOVE PUSH BC:CALL CRM13D,C,PGMD             POP BC:JR NC,FILE_END_FND             DJNZ PGD_CUR_MOVEFILE_END_FND LD A,(CRX):CALL CRMFWD                                JP REFRESH;-------;Move Cursor UpwardGOUP    CALL CRM13U        CALL CRM13U,C,INCCUR        LD A,(CRX):CALL CRMFWD        LD A,(CRP+1)        CP LNZ:CALL Z,PGMUZ        JP REFRESH;-------;Move Cursor DownwardGODW    CALL CRM13D:JR NC,GOD        LD A,(CRX):CALL CRMFWD        LD A,(CRP+1):INC A,A        CP (IX+5):CALL NC,PGMDGOD     JP REFRESH;-------;Move Cursor LeftGOLF    LD HL,(CRP)        LD A,H:CP LNZ:JR NZ,GOlf        LD A,L:OR A:CALL Z,PGMUZGOlf    CALL DECCUR        CALL REFRESH        LD A,(CRP),(CRX),A        RET;-------;Move Cursor RightGORG    LD A,(CRP):CP 80-1:RET NC        LD A,(CRP+1):INC A,A        CP (IX+5):CALL NC,GOrg        CALL INCCUR        CALL REFRESH        LD A,(CRP),(CRX),A        RETGOrg    CALL INCCUR:RET NC        PUSH AF:CALL DECCUR        POP AF:CP #0D+1:RET NC        JP PGMD;-------GO0D    LD A,#0D:CALL INCLCR:RET NC        LD A,(CRP+1):INC A,A        CP (IX+5):CALL NC,PGMD        CALL REFRESH        LD A,(CRP),(CRX),A        JP CHA;-------SMBADD  LD BC,(INOV):BIT 0,C:JR Z,INSM        PUSH AF:CALL INCCUR        POP BC:RET NC        CP #0D+1:LD A,B:JR C,OVRM        CALL DECLCRN        CALL REFRESH        LD A,(CRP),(CRX),A        JP CHAOVRM    PUSH AF:CALL DECCUR        POP AFINSM    CALL INCLCR        CALL REFRESH        LD A,(CRP),(CRX),A        JP CHA;-------SSQ     CALL CRM13U,C,INCCUR        CALL REFRESH        LD A,(CRP),(CRX),A        RETSSE     CALL CRM13D,C,DECCUR        CALL REFRESH        LD A,(CRP),(CRX),A        RET;-------DELETE  CALL INCRCR,REFRESH:JP CHABSPACE  CALL DECLCR:RET NC        LD HL,(CRP)        LD A,H:CP LNZ:JR NZ,Bspc        LD A,L:OR A:CALL Z,PGMUZBspc    CALL REFRESH        LD A,(CRP),(CRX),A        JP CHA;-------STUPD   AND %10000000:RLCA:LD (INOV),A        RET;-------CHA     LD A,1,(CHANGES),A:RET;---------------------------------------REFRESH;---------------------------------------PAGE    ;i: PGHLP - Offset(2) + Page(1)        LD A,(PGHLP+2),(LNHLP+2),A        LD HL,(PGHLP),(LNHLP),HL        LD HL,#0000+LNZ*256,(XY),HLMARA    CALL LINE        LD HL,XY+1:INC (HL)        LD A,(HL):INC A        CP (IX+5):JP C,MARA        RET;---------------------------------------LNE22   JP LNE2;-------LINE    ;Printing Line;       i: LNHLP - Offset(2) + Page(1)        LD HL,0,(CRPOZ),HL        LD A,(LNHLP+2):CALL MNG0VPL        LD DE,(XY):CALL GADRW:EX DE,HLBROOT   LD HL,(LNHLP),BC,(LHLCR),B,#D+1BROO    LD A,C:CP L:JR Z,RYZRAZ     LD A,(HL):CP B:JR C,LNE22ROZ     BIT 7,E:JR NZ,IGLN        LD (DE),A:INC EIGLN    INC HL:BIT 6,H:JR NZ,CRASHX        LD A,C:CP L:JR Z,RYZ        LD A,(HL):CP B:JR C,LNE2        BIT 7,E:JR NZ,IGLN2        LD (DE),A:INC EIGLN2   INC HL:BIT 6,H:JP Z,BROO        JR CRASHXRYZ     LD A,(LHLCR+1):CP H:JP NZ,RAZ        LD A,(LNHLP+2),C,A        LD A,(LHLCR+2):CP C:JR NZ,RAZ        PUSH DE        LD HL,RHLCR,DE,LNHLP.3      LDI        CALL INCLN        PUSH AF        LD A,(LNHLP+2):CALL MNG0VPL        POP AF        POP DE        LD (CRPOZ),DE        LD (CRP),DE        LD A,(XY+1),(CRP+1),A        LD HL,(LNHLP),BC,(LHLCR),B,#D+1        LD A," ":JP NC,ROZ        JP RAZCRASHX  LD A,H:AND %00111111:LD H,A        LD A,(LNHLP+2):INC A        CP PGM+1:JR NC,LNE1        LD (LNHLP+2),A        LD (LNHLP),HL        CALL MNG0VPL        JP BROOTLNE1    DEC HL        LD A,H:AND %00111111:LD H,ALNE2    LD (LNHLP),HL        PUSH DE:CALL INCLN        POP HL        CALL ESTRCLR;-------PRINT   LD E,%10000000        CALL COLORS        CALL CURTAT        RET;---------------------------------------COLORS  EX DE,HL        PUSH HL        LD A,DFCOL.80     LD (HL),A:INC L        POP BC        RET;-------CURTAT  LD HL,(CRPOZ):LD A,H:OR L:RET Z        BIT 7,L:RET NZ        SET 7,L        LD A,(HL):RRD        SET 7,(HL)        RET;-------DAFAQ   LD A,80:SUB L:RET Z,C        LD B,A,(HL),C:INC L:DJNZ $-2:RETESTRCLR LD C," "        LD A,L        CP 64:JR NC,DAFAQ        ADD A,A:LD (BAKC+1),ABAKC    JR $.80     LD (HL),C:INC L        RET;---------------------------------------PGMD    LD A,(PGHLP+2):CALL MNG0VPLPGmd    CALL INCPG:RET NC        LD A,E:CP #0D+1:JR NC,PGmd        RETPGMUZ   CALL PGMU        CALL PGMU,C,INCPG        RETPGMU    LD A,(PGHLP+2):CALL MNG0VPL        LD HL,(PGHLP)PGmu    DEC HL        LD A,H:CP #40:JR NC,ILYA2GILIAN  LD A,(HL):CP #0D+1:JP NC,PGmu        LD (PGHLP),HL        RETILYA2   INC HL:LD (PGHLP),HL        DEC HL        AND %00111111:LD H,A        LD A,(PGHLP+2)        CP PGZ:RET Z:DEC A        LD (PGHLP+2),A        LD (PGHLP),HL        PUSH HL,DE:CALL MNG0VPL        POP DE,HL        JP GILIAN;---------------------------------------DZT     LD DE,#3FFF:JP ZZTFAST    LD A,(RHLCR+2):INC A        CP PGM+1:JR NC,DZT        LD (RHLCR+2),A        PUSH BC:CALL MNGCVPL        POP BC        SET 7,D        SET 6,D        JP FASTBCRM13D  LD A,(LHLCR+2)        EXA:LD A,80:CALL WLD;=CALL MNG0VPL        LD A,(RHLCR+2)        EXA:LD A,65:CALL WLD;=CALL MNGCVPL        LD C,#0D+1CR13D   LD HL,(LHLCR)        LD DE,(RHLCR)        SET 7,D        SET 6,DCR13DD  INC DE:BIT 7,D:JR Z,FASTFASTB   LD A,(DE),(HL),A        INC HL:BIT 6,H:JR NZ,FAST2FAST2B  CP C:JP NC,CR13DDZZT     LD (LHLCR),HL        RES 7,D        RES 6,D        LD (RHLCR),DE        RET;-------FAST2   PUSH AF        LD A,H:AND %00111111:LD H,A        LD A,(LHLCR+2):INC A        LD (LHLCR+2),A        PUSH BC:CALL MNG0VPL        POP BC        POP AF        JP FAST2B;---------------------------------------     AZT     LD HL,0:JP AZZFAZT    LD A,H:AND %00111111:LD H,A        LD A,(LHLCR+2):CP PGZ:JR Z,AZT:DEC A        LD (LHLCR+2),A        PUSH BC:CALL MNG0VPL        POP BC        JP FAZTBCRM13U  LD A,(LHLCR+2)        EXA:LD A,80:CALL WLD;=CALL MNG0VPL        LD A,(RHLCR+2)        EXA:LD A,65:CALL WLD;=CALL MNGCVPL        LD C,#0D+1CR13U   LD HL,(LHLCR)        LD DE,(RHLCR)        SET 7,D        SET 6,DCR13UU  DEC HL:BIT 7,H:JR NZ,FAZTFAZTB   LD A,(HL),(DE),A                DEC DE:BIT 6,D:JR Z,FAZT2FAZT2B  CP C:JP NC,CR13UUAZZ     LD (LHLCR),HL        RES 7,D        RES 6,D        LD (RHLCR),DE        RETFAZT2   SET 6,D        PUSH AF        LD A,(RHLCR+2):DEC A        LD (RHLCR+2),A        PUSH BC:CALL MNGCVPL        POP BC        POP AF              JP FAZT2B;---------------------------------------SAZT    LD HL,0:JP SAZZSFAZT   LD A,H:AND %00111111:LD H,A        LD A,(LHLCR+2):CP PGZ:JR Z,SAZT:DEC A        LD (LHLCR+2),A        PUSH BC:CALL MNG0VPL        POP BC        JP SFAZTBSCRM13U LD A,(LHLCR+2):CALL MNG0VPL        LD A,(RHLCR+2):CALL MNGCVPL        LD BC,#0D+1        LD HL,(LHLCR)        LD DE,(RHLCR)        SET 7,D        SET 6,DSCR13UU DJNZ S:LD B,1S       DEC HL:BIT 7,H:JR NZ,SFAZTSFAZTB  LD A,(HL),(DE),A                DEC DE:BIT 6,D:JR Z,SFAZT2SFAZT2B CP C:JP NC,SCR13UUSAZZ    LD (LHLCR),HL        RES 7,D        RES 6,D        LD (RHLCR),DE        EXA        XOR A:SUB B        DEC A:LD B,A        EXA        RETSFAZT2  SET 6,D        PUSH AF        LD A,(RHLCR+2):DEC A        LD (RHLCR+2),A        PUSH BC:CALL MNGCVPL        POP BC        POP AF              JP SFAZT2B;---------------------------------------CRMFWD  OR A:RET Z        LD B,ACRFWD   PUSH BC:CALL INCCUR        POP BC:RET NC        CP #0D+1:JP C,DECCUR        DJNZ CRFWD        SCF        RET;---------------------------------------INCLN   LD HL,(LNHLP):INC HL        LD A,H:CP #40:JR NC,CRASH        LD (LNHLP),HL        SCF        RETCRASH   AND %00111111:LD H,A        LD A,(LNHLP+2):INC A        CP PGM+1:RET NC        LD (LNHLP+2),A        LD (LNHLP),HL        SCF        RET;---------------------------------------INCPG   LD HL,(PGHLP),E,(HL):INC HL        LD A,H:CP #40:JR NC,ILYA        LD (PGHLP),HL        SCF        RETILYA    AND %00111111:LD H,A        LD A,(PGHLP+2):INC A        CP PGM+1:RET NC        LD (PGHLP+2),A        LD (PGHLP),HL        PUSH DE;CALL MNG0VPL        EXA:LD A,80:CALL WLD        POP DE        SCF        RET;---------------------------------------INCLCR  PUSH AF        LD A,(LHLCR+2)        EXA:LD A,80:CALL WLD;=CALL MNG0VPL        POP DE        LD HL,(LHLCR),(HL),D:INC HL        LD A,H:CP #40:JR NC,GRAD        LD A,(LHLCR+2)GRADB   LD DE,(RHLCR)        PUSH HL:OR A:SBC HL,DE        POP HL:JR NZ,LEQR        LD BC,(RHLCR+2):CP C:RET ZLEQR    LD (LHLCR+2),A        LD (LHLCR),HL        SCF        RET;-------GRAD    AND %00111111:LD H,A        LD A,(LHLCR+2):INC A        JP GRADB;---------------------------------------DECLCRN LD C,A        LD HL,(LHLCR):DEC HL        LD A,H:CP #40:JR NC,NULL        LD A,(LHLCR+2)NULLB   PUSH HL,BC:CALL MNG0VPL        POP BC,HL        LD (HL),C        SCF        RETNULL    AND %00111111:LD H,A        LD A,(LHLCR+2)        CP PGZ:RET Z:DEC A        JP NULLB;---------------------------------------DECLCR  LD HL,(LHLCR):DEC HL        LD A,H:CP #40:JR NC,CRASXCRASXB  LD (LHLCR),HL        SCF        RETCRASX   AND %00111111:LD H,A        LD A,(LHLCR+2)        CP PGZ:RET Z:DEC A        LD (LHLCR+2),A        JP CRASXB;-------INCRCR  LD HL,(RHLCR):INC HL        LD A,H:CP #40:JR NC,GRADXGRADXB  LD (RHLCR),HL        SCF        RETGRADX   AND %00111111:LD H,A        LD A,(RHLCR+2):INC A        CP PGM+1:RET NC        LD (RHLCR+2),A        JP GRADXB;---------------------------------------CRAS    AND %00111111:LD H,A        LD A,(LHLCR+2)        CP PGZ:RET Z:DEC A        LD (LHLCR+2),A        JP CRASBDECCUR  LD HL,(LHLCR):DEC HL        LD A,H:CP #40:JR NC,CRASCRASB   LD (LHLCR),HL;-------        LD A,(LHLCR+2)        EXA:LD A,80:CALL WLD;=CALL MNG0VPL        LD HL,(LHLCR)        LD A,(HL)        PUSH AF        LD A,(RHLCR+2)        EXA:LD A,80:CALL WLD;=CALL MNG0VPL        LD HL,(RHLCR)        POP AF        LD (HL),A;-------        EXA        LD HL,(RHLCR):DEC HL        LD A,H:CP #40:JR NC,CRAShCRAShB  LD (RHLCR),HL        EXA        SCF        RET;-------CRASh   AND %00111111:LD H,A        LD A,(RHLCR+2):DEC A        LD (RHLCR+2),A        JP CRAShB;---------------------------------------CRASH2  AND %00111111:LD H,A        LD A,(RHLCR+2):INC A        CP PGM+1:RET NC        LD (RHLCR+2),A        JP CRASH2BINCCUR  LD HL,(RHLCR):INC HL        LD A,H:CP #40:JR NC,CRASH2CRASH2B LD (RHLCR),HL;-------        LD A,(RHLCR+2)        EXA:LD A,80:CALL WLD;=CALL MNG0VPL        LD HL,(RHLCR)        LD A,(HL)        PUSH AF        LD A,(LHLCR+2)        EXA:LD A,80:CALL WLD;=CALL MNG0VPL        LD HL,(LHLCR)        POP AF        LD (HL),A;-------        EXA        LD HL,(LHLCR):INC HL        LD A,H:CP #40:JR NC,CRASh2CRASh2B LD (LHLCR),HL        EXA        SCF        RET;-------CRASh2  AND %00111111:LD H,A        LD A,(LHLCR+2):INC A        LD (LHLCR+2),A        JP CRASh2B;---------------------------------------LOAD    CALL LOADFL        LD HL,(DAHL)        LD DE,(DADE)        CALL LNT3        LD (SHLA+2),A        LD (SHLA),HL        LD A,PGM,(DHLA+2),A        LD HL,#3FFF,(DHLA),HL        LD HL,(DAHL)        LD DE,(DADE)        CALL LDDRR        LD A,(DHLA+2),(RHLCR+2),A        LD HL,(DHLA),(RHLCR),HL        XOR A:LD (LHLCR+2),A        LD HL,0,(LHLCR),HL        RET;-------LOADFL  XOR A:LD (APG),ALFL     LD A,(APG):CALL MNGCVPL        LD HL,#C000,B,32:CALL LOAD512        CP #0F:RET Z        LD HL,APG:INC (HL)        LD A,(HL):CP PGM+1:RET NC        JR LFL;---------------------------------------LDDRR   ;i: [DE,HL] - Lenght;              SHLA - Source;              DHLA - Dest        LD A,L:OR H,E,D:RET Z        LD (LHLA),HL        LD (LHLA+2),DEDDRR    LD A,(LHLA+3):OR A:RET NZ        LD A,(SHLA+2):CALL MNG0VPL        LD A,(DHLA+2):CALL MNGCVPL        LD HL,(SHLA)        LD DE,(DHLA)        PUSH HL:OR A:SBC HL,DE        POP HL:LD BC,HL        JR C,$+4:LD BC,DE        INC BC        PUSH HL,DE        LD DE,(LHLA+2)        LD HL,(LHLA)        OR A:SBC HL,BC:JR NC,$+3:DEC DE        LD A,D:OR E,H,L:JR NZ,$+4:LD D,1        LD (LHLA+2),DE        LD (LHLA),HL        LD A,D:OR A:JR Z,CRH        ADD HL,BC:LD BC,HLCRH     POP DE,HL        LD A,D:AND %00111111:OR #C0        LD D,A        LDDR        LD A,D        CP #C0:JR NC,MGN        EXA        LD A,(DHLA+2):DEC A        LD (DHLA+2),A        EXAMGN     AND %00111111        LD D,A        LD A,H        CP #40:JR C,MGN2        AND %00111111        LD H,A        LD A,(SHLA+2):DEC A        LD (SHLA+2),AMGN2    LD (SHLA),HL        LD (DHLA),DE        JP DDRR;---------------------------------------LDIRR   ;i: [DE,HL] - Lenght;              SHLA - Source;              DHLA - Dest        LD A,L:OR H,E,D:RET Z        LD (LHLA),HL        LD (LHLA+2),DEDIRR    LD A,(LHLA+3):OR A:RET NZ        LD A,(SHLA+2):CALL MNG0VPL        LD A,(DHLA+2):CALL MNGCVPL        LD HL,(SHLA)        LD DE,(DHLA)        SET 7,D        SET 6,DUBAL    LDI        BIT 6,D:JR Z,DDESTBALLU   BIT 6,H:JP Z,UBALDSORC   LD HL,#0000        LD A,(SHLA+2):INC A        LD (SHLA+2),A        CP PGM+1:JR NC,DSE        CALL MNG0VPL        JP UBALDDEST   LD A,(DHLA+2):INC A        LD (DHLA+2),A        CALL MNGCVPL        LD DE,#C000        JP BALLUDSE     LD (SHLA),HL        XOR A:LD (DE),A        RES 6,D        RES 7,D        LD (DHLA),DE        RET;---------------------------------------SAVECH  LD A,(CHANGES):OR A:RET Z        PUSH IX        LD IX,WMWND:CALL PRWOW        LD HL,ME01,DE,#0100:CALL TXTPR        LD A,#01:CALL YNSDM     EI:HALT        XOR A:CALL YN        CALL ESC:JR NZ,BACK2EDIT        CALL ENKE:JR Z,SDM        CALL RRESB        LD A,#FF:CALL YN:JR NZ,NOCH        CALL QSAVENOCH    POP IX        XOR A        RETBACK2EDIT CALL RRESB          POP IX          SCF          RET;---------------------------------------LNT3    ;i: [DE,HL] - File Lenght;        o:      HL - Offset in Page;                 A - Page        LD BC,1        OR A:SBC HL,BC:JR NC,$+3:DEC DE        LD A,H.2      SLA A:RL E        LD A,H:AND %00111111        LD H,A        LD A,E        RET;---------------------------------------PRTOSV  CALL NORMFL        LD A,(DHLA+2)        LD BC,(DHLA)YORGE   PUSH BC        LD HL,0,DE,HL        OR A:LD BC,#4000:CALL NZ,YOYO        POP BC        ADD HL,BC:JR NC,$+3:INC DE        RETYOYO    ADD HL,BC:JR NC,$+3:INC DE        DEC A:JR NZ,YOYO        RET;---------------------------------------TOWORK  CALL DECSRC        LD HL,(DHLA)        LD A,(DHLA+2)        PUSH HL        LD HL,SHLA        LD DE,DHLA        LD BC,3:LDIR        POP HL        LD (SHLA),HL        LD (SHLA+2),A        CALL DECSRC        LD HL,(LHLB)        LD DE,(LHLB+2)        CALL LDDRR        RETDECSRC  LD HL,(SHLA):DEC HL        LD A,H:CP #40:JR NC,GRDXGRDXB   LD (SHLA),HL        RETGRDX    AND %00111111:LD H,A        LD A,(SHLA+2):DEC A        CP PGM+1:RET NC        LD (SHLA+2),A        JP GRDXB;---------------------------------------NORMFL  CALL RCRTD        CALL INCRCR        LD HL,LHLCR,DE,DHLA,BC,3:LDIR        LD HL,RHLCR,DE,SHLA,C,3:LDIR        LD BC,(SHLA+2)        LD A,PGM:SUB C        LD BC,(SHLA)        LD HL,#4000:OR A:SBC HL,BC        LD BC,HL        CALL YORGE        LD (LHLB),HL        LD (LHLB+2),DE        CALL LDIRR        CALL DCRTR        RETRCRTD   LD HL,RHLCR,DE,RHLCR2,BC,3:LDIR:RETDCRTR   LD HL,RHLCR2,DE,RHLCR,BC,3:LDIR:RET;---------------------------------------NAMETOH LD HL,WHEAD,DE,HL:INC DE        LD BC,80,(HL),32:LDIR        LD HL,ENTRYN        LD DE,WHEAD        LD B,80-10NMTHD   LD A,(HL):CP 32:JR C,BAX        LD (DE),A:INC HL,DE        DJNZ NMTHDBAX     LD HL,WHEAD        LD DE,#0006        LD BC,80-16:CALL PRSRW        RET;---------------------------------------SEARCHNEXT JR GOsrh7SEARCH  PUSH IX        LD IX,SRHWND:CALL PRWOW        LD C,0        CALL STRBULL:JR Z,SRHZERO        INC DE:LD C,ESRHZERO EXX:LD HL,STRBUFFL:EXX:LD HL,STRBUFF,DE,#0101,B,#28,A,#FD:CALL ISTRSRHMAIN EI:HALT        CALL ENKE:JR NZ,GOSRH7        CALL ESC:JR NZ,SRHEXIT        XOR A:CALL ISTR        LD A,2:CALL ISTR        JR SRHMAINSRHEXIT CALL RRESB        POP IX        XOR A        RETGOSRH7  CALL RRESB:POP IXGOsrh7  CALL STRBULL:RET Z        CALL PRTOBACK        CALL GOSRH:JR NC,COMEBACK        CALL SCRM13U        PUSH BC:CALL C,INCCUR        LD HL,LHLCR,DE,PGHLP,BC,3:LDIR        LD A,(IX+5):SUB LNZ+1+1:SRL A        LD B,ASRHGE   PUSH BC:CALL PGMUZ        POP BC:JR NC,SRHge        DJNZ SRHGESRHge   POP AF        LD (CRX),A:CALL CRMFWDSRHET   CALL REFRESH        XOR A        RETCOMEBACK PUSH IX         LD IX,NFNDWND:CALL PRWOW         LD HL,DHLA,DE,LHLCR,BC,3:LDIR         LD HL,RHLCR2,DE,RHLCR,C,3:LDIR         CALL TOWORK         CALL USPO         CALL NUSP         CALL RRESB         POP IX         JR SRHETPRTOBACK PUSH DE         CALL RCRTD         CALL INCRCR         LD HL,LHLCR,DE,DHLA,BC,3:LDIR         LD HL,RHLCR,DE,SHLA,C,3:LDIR         LD BC,(SHLA+2)         LD A,PGM:SUB C         LD BC,(SHLA)         LD HL,#4000:OR A:SBC HL,BC         LD BC,HL         CALL YORGE         LD (LHLB),HL         LD (LHLB+2),DE         CALL DCRTR         POP DE         RET;-------SRHDZT    LD DE,#3FFF:JP SRHZZTSRHFAST   LD A,(RHLCR+2):INC A          CP PGM+1:JR NC,SRHDZT          LD (RHLCR+2),A          PUSH BC:CALL MNGCVPL          POP BC          SET 7,D          SET 6,D          JP SRHFASTB;-------GOSRH     INC DE:LD HL,STRBUFF:ADD HL,DE:LD (HL),0,(STRBUFA),HL          LD A,(LHLCR+2):CALL MNG0VPL          LD A,(RHLCR+2):CALL MNGCVPL          LD BC,(LHLCR)          LD DE,(RHLCR)          SET 7,D          SET 6,DSRHFRST   LD HL,STRBUFFSRH13DD   LD A,(HL):OR A:JR Z,SRHFOUND          INC DE:BIT 7,D:JR Z,SRHFASTSRHFASTB  LD A,(DE),(BC),A:CP (HL):JR Z,SRHNXT          LD HL,STRBUFFSRHNXTB   INC BC:BIT 6,B:JR NZ,SRHFAST2SRHFAST2B CP #0D+1:JP NC,SRH13DD          JP SRHFRSTSRHNXT    INC HL:JP SRHNXTBSRHFOUND  SCFSRHZZT    LD HL,(STRBUFA),(HL)," "          LD (LHLCR),BC          RES 7,D          RES 6,D          LD (RHLCR),DE          RET;-------SRHFAST2  PUSH AF          LD A,B:AND %00111111:LD B,A          LD A,(LHLCR+2):INC A          LD (LHLCR+2),A          PUSH BC:CALL MNG0VPL          POP BC          POP AF          JP SRHFAST2B;-------STRBULL LD DE,STRBUFFL-1        LD HL,STRBUFF+STRBUFFL-1STRSTRS LD A,(HL):CP " ":RET NZ        DEC HL,DE:LD A,D:OR E:JP NZ,STRSTRSSTRSTR  XOR A        RET;---------------------------------------F1MENU  PUSH IX        LD IX,F1WND:CALL PRWOW        CALL USPO        CALL NUSP        CALL RRESB        POP IX        RET;---------------------------------------QSAVE   PUSH IX        LD IX,SVWND:CALL PRWOW        CALL PRTOSV        LD (DAHL),HL        LD (DADE),DE        LD HL,FLLOAD,(HL),#00        CALL DELFL:JR Z,NFER        LD HL,(DAHL),(FLMAKE+1+0),HL        LD HL,(DADE),(FLMAKE+1+2),HL        LD HL,FLMAKE,(HL),#00        CALL MKFILE:JR NZ,MKER        CALL SAVEDAT        LD A,3,(ESTA),A        XOR A:LD (CHANGES),ABTZF    CALL TOWORK        CALL RRESB        POP IX        CALL REFRESH        XOR A        RET;-------NFERMKER    PUSH IX        LD IX,ERWND:CALL PRWOW        CALL USPO        CALL NUSP        CALL RRESB        POP IX        JR BTZF;---------------------------------------SAVEDAT LD A,PGZ,(SVD+1),ASVD     LD A,0        CALL MNGCVPL        LD HL,SVD+1:INC (HL)        LD HL,#C000,B,32:CALL SAVE512        CP #0F:RET Z        LD BC,(DHLA+2):INC C        LD A,(SVD+1):CP C:RET NC        JP SVD;---------------------------------------MNGC_PL EXA:LD A,0:JP WLDMNG0_PL EXA:LD A,78:JP WLDMNG8_PL EXA:LD A,79:JP WLDPRWOW   LD A,1:JP WLDRRESB   LD A,2:JP WLDPRSRW   LD A,3:JP WLDPRIAT   EXA:LD A,4:JP WLDGADRW   LD A,5:JP WLDCURSOR  LD A,6:JP WLDCURSER  LD A,7:JP WLDYN      EXA:LD A,8:JP WLDISTR    EXA:LD A,9:JP WLDNORK    EXA:LD A,10:JP WLDTXTPR   LD A,11:JP WLDDMAPL   EXA:LD A,13:JP WLDGEDPL   LD A,15:JP WLD;-------KBSCN   EXA:LD A,42:JP WLDSPKE    LD A,16:JP WLDUPPP    LD A,17:JP WLDDWWW    LD A,18:JP WLDLFFF    LD A,19:JP WLDRGGG    LD A,20:JP WLDTABK    LD A,21:JP WLDENKE    LD A,22:JP WLDBSPC    LD A,24:JP WLDPGUP    LD A,25:JP WLDPGDN    LD A,26:JP WLDDEL     LD A,43:JP WLDESC     LD A,23:JP WLDHOME    LD A,27:JP WLDEND     LD A,28:JP WLDF1      LD A,29:JP WLDF5      LD A,33:JP WLDF10     LD A,38:JP WLDALT     LD A,39:JP WLDSHIFT   LD A,40:JP WLDCTRL    LD A,41:JP WLDUSPO    LD A,46:JP WLDNUSP    LD A,47:JP WLD;-------LOAD512 LD A,48:JP WLDLOAD256 LD A,60:JP WLDLOADNON LD A,61:JP WLDSAVE512 LD A,49:JP WLDFENTRY  LD A,59:JP WLDGFILE   LD A,62:JP WLDMKFILE  LD A,72:JP WLDDELFL   LD A,75:JP WLD;-------MNGV_PL EXA:LD A,64:JP WLDMNGCVPL EXA:LD A,65:JP WLDMNG0VPL EXA:LD A,80:JP WLDGVmod   EXA:LD A,66:JP WLDGYoff   LD A,67:JP WLDGXoff   LD A,68:JP WLD;---------------------------------------PLWND   DB 2,0        DB 0,0;      X,Y        DB 80,0;     W,H        DB %00010111;PAPER+INK        DB 0        DW #0; BUFFER        DB 0,0;LINES        DB 1,5;        CURnow,CURmax        DB %11110001,0;CURcolor        DW TAPT        DW TAPB        DW 0;-------TAPT    DB #8,#1        DB "File:               "        DB "                    "        DB "                    "        DB "                    "        DB 0TAPB    DB #8,#1        DB "                    "        DB "                    "        DB "                    "        DB "                    "        DB 0;-------SVWND   DB 1,0        DB 29,13;    X,Y        DB 20+2,1+2; W,H        DB %01111111;PAPER+INK        DB 0        DW #0; BUFFER        DB 0,0;LINES        DW 0        DW 0        DW SAVINGMSAVINGM DB #E,"Saving...",0;-------WMWND   DB 1,0        DB 21,12;    X,Y        DB 40+2,4+2; W,H        DB %01111111;PAPER+INK        DB 0        DW #0; BUFFER        DB 2,0;LINES        DW WARNING        DW 0        DW 0WARNING DB #9,#E,"WARNING!",0;-------ERWND   DB 1,0        DB 21,13;    X,Y        DB 40+2,2+2; W,H        DB %00111111;PAPER+INK        DB 0        DW #0; BUFFER        DB 0,0;LINES        DW ERT        DW ERB        DW 0ERT     DB #9,#E,"ERROR:",0ERB     DB #9,#E,"press any key",0;-------ME01    DB #0E,"Save changes?",0;-------SRHWND  DB 1,0        DB 21,11;    X,Y        DB 40+2,1+2; W,H        DB %01001111;PAPER+INK        DB 0        DW #0; BUFFER        DB 0,0;LINES        DW SRHT        DW 0        DW 0SRHT    DB #9,#E,"SEARCH:",0;-------NFNDWND DB 1,0        DB 26,13;    X,Y        DB 30+2,1+2; W,H        DB %00101111;PAPER+INK        DB 0        DW #0; BUFFER        DB 0,0;LINES        DW 0        DW 0        DW NFNDNFND    DB #E,"Not found!!!",0;-------F1WND   DB 1,0        DB 8,4        DB 64,16        DB %01111111        DB 0        DW #0        DB 0,0        DW F1T        DW F1B        DW F1AF1T     DB #9,#E,"TEXT Editor HELP Page",0F1B     DB #9,#E,"PRESS any key to CLOSE this Window",0F1A     DB "Controls:",#D        DB 1,"ESC - Exit (выход)",#D        DB #D        DB 1,"ctrl+S - Save changes (сохранить изменения)",#D        DB 1,"ctrl+F - Find Text (поиск текста)",#D        DB 1,"ctrl+G - Find Next (искать дальше)",#D        DB 1,"ctrl+HOME - GO to File Start (перейти в начало файла)",#D        DB 1,"ctrl+END - GO to File End (перейти в конец файла)",#D        DB #D        DB 1,"ctrl+SHIFT - ENG/RUS (выбор языка ввода)",#D        DB #D        DB "Other Controls:",#D        DB 1,"pgUP,pgDN,HOME,END,DELETE,BSPACE,INSERT,CAPSLOCK",#D        NOP;---------------------------------------ESTA    NOP;ExitStateCHANGES NOP;!=0 if text changed;File-sizeDAHL    DS 2;LowDADE    DS 2;High;LoadingAPG     NOP ;Active PageLHLA    DS 4;LenghtLHLB    DS 4SHLA    DS 3;Source Position [Offset(2)+Page(1)]DHLA    DS 3;Dest. Position  [Offset(2)+Page(1)];TXT-editingCRX     NOP ;CURSOR X representationCRY     NOP ;CURSOR Y representationCRXX    DS 2;ColCRYY    DS 2;LnXY      DS 2;temp. XY (uses in Line Print)INOV    NOP ;0-INS, 1-OVERLHLCR   DS 3;Left Cursor Position [Offset(2)+Page(1)]RHLCR   DS 3;Right Cursor Position [Offset(2)+Page(1)]LHLCR2  DS 3RHLCR2  DS 3PGHLP   DS 3; TXT Page Start Address [Offset(2)+Page(1)]LNHLP   DS 3; TXT Line --//--;COLORSCRPOZ   DS 2CRP     DS 2;SEARCHSTRBUFA  DW 0;         Address of stop tokenSTRBUFF  DS 40," ";    Searching stringSTRBUFFL EQU $-STRBUFF;String Size         NOP;---------------------------------------ENDPL;---------------------------------------;---------------------------------------